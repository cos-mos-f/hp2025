了解しました。GitHub Pages（静的配信）と Lightsail（Node.js サーバー、SQLite 利用）を前提に、拡張しやすい**モノレポ構成**を提案します。npm ワークスペースで管理し、静的サイト（web）と API サーバー（server）、共有コード（shared）、インフラ・CI（infra, .github）を分離します。

```text
your-repo/
├─ package.json                # npm workspaces ルート。共通スクリプトもここで定義
├─ package-lock.json
├─ tsconfig.base.json          # TypeScript 共通設定（必要なら）
├─ .gitignore
├─ .editorconfig
├─ .nvmrc
├─ .env.example                # ルート共通のサンプル環境変数（最低限）
│
├─ apps/
│  ├─ web/                     # GitHub Pages に静的出力（Next.js を想定）
│  │  ├─ package.json
│  │  ├─ next.config.mjs       # { output: 'export', basePath/assetPrefix など GH Pages 向け設定 }
│  │  ├─ src/
│  │  │  ├─ app/ or pages/     # Next.js アプリ本体
│  │  │  ├─ components/
│  │  │  ├─ lib/               # フロント固有の util。server 由来の型は shared から import
│  │  ├─ public/
│  │  ├─ styles/
│  │  ├─ .env.local.example
│  │  └─ README.md
│  │
│  └─ server/                  # Lightsail 上の Node.js（Fastify/Express など）
│     ├─ package.json
│     ├─ tsconfig.json
│     ├─ src/
│     │  ├─ index.ts           # 起動エントリ（環境変数読込→サーバー起動）
│     │  ├─ app.ts             # フレームワーク初期化（ルーティング登録）
│     │  ├─ routes/
│     │  │  ├─ health.ts
│     │  │  └─ v1/
│     │  │     └─ *.ts
│     │  ├─ services/          # ビジネスロジック
│     │  ├─ repositories/      # DB アクセス層（Prisma/Drizzle 経由）
│     │  ├─ db/
│     │  │  ├─ prisma/
│     │  │  │  ├─ schema.prisma
│     │  │  │  └─ migrations/  # 自動生成
│     │  │  ├─ client.ts       # PrismaClient 初期化
│     │  │  └─ seed.ts         # 初期データ投入（必要な場合）
│     │  ├─ env.ts             # zod 等で環境変数を検証
│     │  └─ utils/
│     ├─ data/
│     │  └─ app.sqlite         # SQLite 実体（本番は権限/バックアップに注意）
│     ├─ prisma/
│     │  └─ seed/              # 大きめの seed データがあれば分離
│     ├─ .env.example          # SERVER_PORT, DATABASE_URL 等
│     ├─ Dockerfile            # 任意：Lightsail で Docker 運用するなら
│     ├─ ecosystem.config.cjs  # pm2 運用するなら
│     └─ README.md
│
├─ packages/
│  └─ shared/                  # サーバー/フロントで共通利用
│     ├─ package.json
│     ├─ tsconfig.json
│     ├─ src/
│     │  ├─ types/             # 共通型定義（API リクエスト/レスポンス、Domain 型）
│     │  ├─ schemas/           # zod スキーマ（入出力検証を server/web で共有）
│     │  ├─ constants/
│     │  └─ utils/             # 依存の軽い共通 util（DOM 前提の処理は置かない）
│     └─ README.md
│
├─ infra/
│  ├─ lightsail/
│  │  ├─ nginx/                # 逆プロキシを置くなら（任意）
│  │  │  └─ server.conf
│  │  ├─ systemd/              # Node/pm2 を使わず systemd 管理する場合（任意）
│  │  │  └─ your-app.service
│  │  ├─ scripts/
│  │  │  ├─ deploy_server.sh   # SSH/rsync で配布→npm ci→migrate→再起動
│  │  │  ├─ backup_db.sh       # SQLite のコールド/ホットバックアップ手順
│  │  │  └─ restore_db.sh
│  │  └─ README.md
│  └─ github-pages/
│     └─ CNAME                 # 独自ドメインを GH Pages で使うなら（cos-mos-f.com 等）
│
└─ .github/
   └─ workflows/
      ├─ pages-deploy.yml      # web を静的出力→GitHub Pages にデプロイ
      └─ server-deploy.yml     # server を Lightsail にデプロイ（SSH 秘密鍵を使用）
```

### ポイント解説

1. モノレポとワークスペース

* ルート `package.json`（npm workspaces）で `apps/*` と `packages/*` を管理します。
* `packages/shared` に API 型定義と zod スキーマを置き、**web/server で厳密に同一の入出力**を扱えます。将来のモバイルアプリや CLI 追加にも対応しやすくなります。

2. Web（GitHub Pages）

* Next.js を想定し、`next.config.mjs` で

  * `output: 'export'`（静的書き出し）
  * `basePath` と `assetPrefix`（リポジトリ名配信 or 独自ドメインに応じ調整）
    を設定します。ビルド後 `out/` に出力し、Pages へ配置します。`out/.nojekyll` を追加すると `_*` から始まるパス問題を回避できます。
* API 呼び出しは Lightsail 側の **HTTPS エンドポイント**へ（例: `https://backend.cos-mos-f.com`）。フロント側 `.env.local` には `NEXT_PUBLIC_API_ORIGIN` のみ持たせ、秘密情報は持たせません。

3. Server（Lightsail、SQLite）

* `DATABASE_URL="file:./data/app.sqlite"` のように相対パス指定（Prisma）。`data/` ディレクトリは**書き込み権限**と**バックアップ**を考慮します。
* Prisma を使う場合、`schema.prisma` に `provider = "sqlite"`。`migrations/` は自動生成されます。
* 起動管理は pm2 か systemd のいずれか。`ecosystem.config.cjs`（pm2）に `env_production` を分け、`PORT` や `NODE_ENV` を集中管理します。

4. CI/CD（GitHub Actions）

* `pages-deploy.yml`：`apps/web` をビルド→`out/` を Pages に公開。CNAME がある場合は `infra/github-pages/CNAME` を成果物に含めます。
* `server-deploy.yml`：Lightsail へ SSH/rsync で `apps/server` のみを配布。配布後に

  * `npm ci --omit=dev`
  * `npx prisma migrate deploy`
  * `pm2 reload` または `systemctl restart`
    を実行します。SSH 鍵やホスト名、ユーザーは GitHub Secrets で管理します。

5. スクリプトと運用補助

* `infra/lightsail/scripts/backup_db.sh`：SQLite のバックアップ（スナップショット取得、WAL モード対応など）を定期実行。cron での運用を想定。
* `restore_db.sh`：復元手順を明文化。
* `deploy_server.sh`：ローカル検証や CI が使えない場合の手動デプロイを簡略化。

6. ルートの共通スクリプト例（抜粋イメージ）

```json
{
  "name": "your-repo",
  "private": true,
  "workspaces": ["apps/*", "packages/*"],
  "scripts": {
    "build": "npm run build -w apps/web && npm run build -w apps/server",
    "build:web": "npm run build -w apps/web",
    "build:server": "npm run build -w apps/server",
    "dev:web": "npm run dev -w apps/web",
    "dev:server": "npm run dev -w apps/server",
    "lint": "eslint .",
    "typecheck": "tsc -b"
  }
}
```

### 環境変数の整理（例）

* ルート `.env.example`（参考値のみ）

  * `NODE_ENV=production`
  * `NEXT_PUBLIC_API_ORIGIN=https://backend.cos-mos-f.com`
* `apps/server/.env.example`

  * `SERVER_PORT=3000`
  * `DATABASE_URL=file:./data/app.sqlite`
  * `CORS_ORIGIN=https://cos-mos-f.com`（GitHub Pages 側の本番オリジン）
  * `LOG_LEVEL=info`

### GitHub Pages（Next.js）特記事項

* リポジトリ名配信の場合は `basePath='/<repo-name>'` を設定。独自ドメイン（`cos-mos-f.com`）かつ apex/サブドメイン直配信なら `basePath` 不要で `assetPrefix` も `/` にできます。
* ビルド時に `touch out/.nojekyll` を入れる運用を推奨。
* 画像最適化は静的出力に合わせて `next/image` の `unoptimized: true` を考慮します。

### SQLite の配置方針

* 本番の DB ファイルは `apps/server/data/app.sqlite`。バックアップは `infra/lightsail/backups/` 等に日付付きで保存。
* WAL モードを有効化すると同時アクセス耐性が高まります（マイグレーション時のロックに注意）。
* 将来的に RDB を外出しする場合も、`DATABASE_URL` の切替だけで移行できるよう `repositories/` 経由に依存を閉じ込めます。

---

この構成で、**静的ページの独立デプロイ**と**API サーバーの継続運用**を安全に分離できます。次の段階としては、1) `next.config.mjs` と Actions の雛形、2) server の最小 API（`/health` と `/v1/example`）、3) Prisma の初期スキーマ定義（migrations 初回実行）を固めると、運用開始までスムーズです。
